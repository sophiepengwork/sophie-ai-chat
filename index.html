<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sophie.AI — Personal AI Assistant</title>

  <style>
    body {
        margin: 0;
        background: #ffffff;
        font-family: Inter, sans-serif;
        color: #000;
    }

    /* Sophie 頭像樣式（header + 訊息 + typing 共用） */
    .sophie-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        object-fit: cover;
        flex-shrink: 0;
    }

    /* Header 注入頭像 */
    flowise-fullchatbot .chat-header-title {
        display: flex !important;
        align-items: center !important;
        gap: 10px;
        font-weight: 600;
    }

    /* AI 回覆訊息加頭像 */
    .flowise-ai-msg {
        display: flex !important;
        align-items: flex-start !important;
        gap: 10px;
    }

    .flowise-ai-msg .bubble {
        background: #f2f2f2 !important;
        color: #000 !important;
        border-radius: 12px !important;
        padding: 12px !important;
    }

    /* Typing… 加頭像 */
    .flowise-typing {
        display: flex !important;
        align-items: center !important;
        gap: 10px !important;
        opacity: 0.8;
    }
  </style>
</head>

<body>
  <flowise-fullchatbot></flowise-fullchatbot>

  <script type="module">
      import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js";
      Chatbot.initFull({
          chatflowid: "a24ebb8d-d82a-46df-b0dc-3ba2886ca12a",
          apiHost: "https://cloud.flowiseai.com",
      });
  </script>

  <!-- 動態插入頭像功能 -->
  <script>
      const avatarUrl = "https://avatars.githubusercontent.com/u/174008152?s=200&v=4";

      window.addEventListener("load", () => {
          setTimeout(() => {
              /* Header 頭像 */
              const header = document.querySelector("flowise-fullchatbot .chat-header-title");
              if (header && !header.querySelector("img.sophie-avatar")) {
                  const img = document.createElement("img");
                  img.src = avatarUrl;
                  img.className = "sophie-avatar";
                  header.prepend(img);
              }

              /* 訊息/Typing 監聽 */
              const observer = new MutationObserver(() => {
                  /* AI 訊息頭像 */
                  document.querySelectorAll(".flowise-ai-msg").forEach(msg => {
                      if (!msg.querySelector("img.sophie-avatar")) {
                          const img = document.createElement("img");
                          img.src = avatarUrl;
                          img.className = "sophie-avatar";
                          msg.prepend(img);
                      }
                  });

                  /* Typing 頭像 */
                  const typing = document.querySelector(".flowise-typing");
                  if (typing && !typing.querySelector("img.sophie-avatar")) {
                      const img = document.createElement("img");
                      img.src = avatarUrl;
                      img.className = "sophie-avatar";
                      typing.prepend(img);
                  }
              });

              observer.observe(document.body, { childList: true, subtree: true });
          }, 1200);
      });
  </script>
</body>
</html>
